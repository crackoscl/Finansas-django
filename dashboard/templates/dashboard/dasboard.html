{% extends "base.html" %}

{% load static %}
{% load template_filters %}

{% block contenido %}

<div id="layoutSidenav_content">
    <main>

        <div class="container-fluid px-4">
            <h1 class="mt-4">Dashboard</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">Dashboard</li>
            </ol>
            <div class="row">
                <div class="col-xl-4 col-md-6">
                    <div class="card bg-primary text-white mb-4">
                        <div class="card-body">
                            <h2>Salario</h2>
                            <h4>{{ salario|format_amount }}</h4>

                        </div>

                    </div>
                </div>
                <div class="col-xl-4 col-md-6">
                    <div class="card bg-warning text-white mb-4">
                        <div class="card-body">
                            <h2>Gastos</h2>
                            <h4>{{ gastos|format_amount }}</h4>
                        </div>

                    </div>
                </div>
                <div class="col-xl-4 col-md-6">
                    <div class="card bg-success text-white mb-4">
                        <div class="card-body">
                            <h2>Ahorro</h2>
                            <h4>{{ ahorro|format_amount }}</h4>
                        </div>

                    </div>
                </div>
                {% comment %} <div class="col-xl-3 col-md-6">
                    <div class="card bg-danger text-white mb-4">
                        <div class="card-body">Danger Card</div>

                    </div>
                </div> {% endcomment %}
            </div>
            <div class="row">
                <div class="col-xl-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <svg class="svg-inline--fa fa-chart-area me-1" aria-hidden="true" focusable="false"
                                data-prefix="fas" data-icon="chart-area" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 512 512" data-fa-i2svg="">
                                <path fill="currentColor"
                                    d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64V400c0 44.2 35.8 80 80 80H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H80c-8.8 0-16-7.2-16-16V64zm96 288H448c17.7 0 32-14.3 32-32V251.8c0-7.6-2.7-15-7.7-20.8l-65.8-76.8c-12.1-14.2-33.7-15-46.9-1.8l-21 21c-10 10-26.4 9.2-35.4-1.6l-39.2-47c-12.6-15.1-35.7-15.4-48.7-.6L135.9 215c-5.1 5.8-7.9 13.3-7.9 21.1v84c0 17.7 14.3 32 32 32z">
                                </path>
                            </svg><!-- <i class="fas fa-chart-area me-1"></i> Font Awesome fontawesome.com -->
                            Evolución Mensual
                        </div>
                        <div class="card-body">
                            <div class="chartjs-size-monitor">
                                <div class="chartjs-size-monitor-expand">
                                    <div class=""></div>
                                </div>
                                <div class="chartjs-size-monitor-shrink">
                                    <div class=""></div>
                                </div>
                            </div><canvas id="myAreaChart" width="778" height="311"
                                style="display: block; width: 778px; height: 311px;"
                                class="chartjs-render-monitor"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <svg class="svg-inline--fa fa-chart-bar me-1" aria-hidden="true" focusable="false"
                                data-prefix="fas" data-icon="chart-bar" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 512 512" data-fa-i2svg="">
                                <path fill="currentColor"
                                    d="M32 32c17.7 0 32 14.3 32 32V400c0 8.8 7.2 16 16 16H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H80c-44.2 0-80-35.8-80-80V64C0 46.3 14.3 32 32 32zm96 96c0-17.7 14.3-32 32-32l192 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-192 0c-17.7 0-32-14.3-32-32zm32 64H288c17.7 0 32 14.3 32 32s-14.3 32-32 32H160c-17.7 0-32-14.3-32-32s14.3-32 32-32zm0 96H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H160c-17.7 0-32-14.3-32-32s14.3-32 32-32z">
                                </path>
                            </svg><!-- <i class="fas fa-chart-bar me-1"></i> Font Awesome fontawesome.com -->
                            Ahorro Mensual
                        </div>
                        <div class="card-body">
                            <div class="chartjs-size-monitor">
                                <div class="chartjs-size-monitor-expand">
                                    <div class=""></div>
                                </div>
                                <div class="chartjs-size-monitor-shrink">
                                    <div class=""></div>
                                </div>
                            </div><canvas id="myBarChart" width="778" height="311"
                                style="display: block; width: 778px; height: 311px;"
                                class="chartjs-render-monitor"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-xl-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <svg class="svg-inline--fa fa-chart-area me-1" aria-hidden="true" focusable="false"
                                data-prefix="fas" data-icon="chart-area" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 512 512" data-fa-i2svg="">
                                <path fill="currentColor"
                                    d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64V400c0 44.2 35.8 80 80 80H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H80c-8.8 0-16-7.2-16-16V64zm96 288H448c17.7 0 32-14.3 32-32V251.8c0-7.6-2.7-15-7.7-20.8l-65.8-76.8c-12.1-14.2-33.7-15-46.9-1.8l-21 21c-10 10-26.4 9.2-35.4-1.6l-39.2-47c-12.6-15.1-35.7-15.4-48.7-.6L135.9 215c-5.1 5.8-7.9 13.3-7.9 21.1v84c0 17.7 14.3 32 32 32z">
                                </path>
                            </svg><!-- <i class="fas fa-chart-area me-1"></i> Font Awesome fontawesome.com -->
                            Proporcion Gastos
                        </div>
                        <div class="card-body">
                            <div class="chartjs-size-monitor">
                                <div class="chartjs-size-monitor-expand">
                                    <div class=""></div>
                                </div>
                                <div class="chartjs-size-monitor-shrink">
                                    <div class=""></div>
                                </div>
                            </div><canvas id="myProporcion" width="553" height="553"
                                style="display: block; width: 553px; height: 553px"
                                class="chartjs-render-monitor"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-table me-1"></i>
                            Evolución Gastos
                        </div>
                        <div class="card-body">
                            
                            <table id="datatablesSimple">
                                <thead>
                                    <tr>
                                        <th>Categoria</th>
                                        {% for item in unique_months_gastos %}
                                        <th>{{item}}</th>
                                        {% endfor %}
                                        <th>Total General</th>
                                    </tr>
                                </thead>
                              
                                <tbody>
                                    {% for category in unique_categories %}
                                    <tr>
                                        <td>{{ category }}</td>
                                        {% for month in unique_months_gastos %}
                                        <td>
                                            {% with gasto=0 %}
                                            {% for item in resultados_category_names %}
                                                {% if item.category == category and item.month_name == month %}
                                            {% with gasto=item.gasto %}
                                               {{ gasto|format_amount }}
                                            {% endwith %}
                                            {% endif %}
                                            {% endfor %}
                                            {% endwith %}
                                        </td>
                                        {% endfor %}
                                        <td>
                                            {{ totales_por_categoria|get_item:category|format_amount }}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                 
                                <tfoot id="totales">
                                    <tr id="filaTotales">
                                        <th>Total Mensual:</th>
                                        {% for item in unique_months_gastos %}
                                         <th></th>
                                        {% endfor %}
                                        <th></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>
    <footer class="py-4 bg-light mt-auto">
        <div class="container-fluid px-4">
            <div class="d-flex align-items-center justify-content-between small">
                <div class="text-muted">Copyright © Your Website 2023</div>
                <div>
                    <a href="#">Privacy Policy</a>
                    ·
                    <a href="#">Terms &amp; Conditions</a>
                </div>
            </div>
        </div>
    </footer>
</div>


{% endblock contenido %}

{% block js %}

<script src="{% static 'js/chart_dashboard.js' %}"></script>
<script src="{% static 'js/datatables-dashboard.js' %}"></script>



<script>

$(document).ready(function () {
    charsMensual({{ grafico_mensual | safe}});
    charsAhorroMensual({{ grafico_mensual | safe}});
    charsProporcion({{ category_porcentajes | safe}});
})
</script>

{% endblock js %}